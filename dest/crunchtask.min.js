/*! crunchtask - v0.5.2 - 2015-02-18 */!function(){function a(a,b){return function(){a.apply(b,arguments)}}function b(b){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof b)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],h(b,a(d,this),a(e,this))}function c(a){var b=this;return null===this._state?void this._deferreds.push(a):void j(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function d(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"==typeof b||"function"==typeof b)){var c=b.then;if("function"==typeof c)return void h(a(c,b),a(d,this),a(e,this))}this._state=!0,this._value=b,f.call(this)}catch(g){e.call(this,g)}}function e(a){this._state=!1,this._value=a,f.call(this)}function f(){for(var a=0,b=this._deferreds.length;b>a;a++)c.call(this,this._deferreds[a]);this._deferreds=null}function g(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function h(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var i;i="object"==typeof window&&window?window:global,"undefined"!=typeof module&&module.exports?module.exports=i.Promise?i.Promise:b:i.Promise||(i.Promise=b);var j=i.setImmediate||function(a){setTimeout(a,1)},k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.prototype["catch"]=function(a){return this.then(null,a)},b.prototype.then=function(a,d){var e=this;return new b(function(b,f){c.call(e,new g(a,d,b,f))})},b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new b(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},b.resolve=function(a){return a&&"object"==typeof a&&a.constructor===b?a:new b(function(b){b(a)})},b.reject=function(a){return new b(function(b,c){c(a)})},b.race=function(a){return new b(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})}}(),function(){function a(a){return G.isFunction(a)||a instanceof r}function b(a,b){throw G.isUndefined(b)&&(b=a,a="Generic"),new Error(["`CT_",a,"`. Message: ",b].join(""))}function c(){return++I}function d(a,b){for(var c in b)F.call(b,c)&&(a[c]=b[c]);return a}function e(){var a=this,b=arguments[0],c=E.call(arguments,1);return!G.isFunction(b)&&G.isFunction(c[0])&&(a=arguments[0],b=c.shift()),function(){var d=E.call(arguments,0);return b.apply(a,[].concat(c,d))}}function f(a,b){var c=E.call(arguments,2);return function(){var d=E.call(arguments,0);return b.apply(a,[].concat(c,d))||a}}function g(a){var b=E.call(arguments,1);return function(){for(var c,d=E.call(arguments,0);(c=b.shift())&&G.isFunction(c);)c.apply(this,d);return a.call(this,d)}}function h(a,b,c){if(c)for(var d,e,f=E.call(arguments,3),g=b.split(/\s*,\s*/);d=g.shift();)(e=a[d])?e.push([c,f]):a[d]=[[c,f]]}function i(a,b){var c=E.call(arguments,2);if(1===c.length&&G.isArray(c[0])&&(c=c[0]),a[b])for(var d,e,f,g=a[b],h=0,i=g.length;i>h;h++)if(d=g[h],e=d[0],f=d[1],e)try{e.apply(this,[].concat(f,c))}catch(j){console.info(j)}}function j(a,b,c){var d=this;setTimeout(function(){b.apply(d,c)},a||0)}function k(a,b){var c=this,d=E.call(arguments,2);delete this.isPaused,delete this.isAborted,this.runCount++,b.trigger(J.run);var f,h=function(a){var b={isSettled:null},c={"null":!1,"true":!0,"false":!0,paused:!1,aborted:!0};return{updateSettledTrue:function(){c[b.isSettled]||(b.isSettled=!0,a.runCount--)},updateSettledFalse:function(){c[b.isSettled]||(b.isSettled=!1,a.runCount--)},updateSettledVal:function(d){c[b.isSettled]||(b.isSettled=d,c[d]&&a.runCount--)},status:function(){return b.isSettled}}}(c);try{return f=new H(function(f,i){var k,m,n,o,p;a?(a(function(a){k=a},function(a,b,c){m=a,o=b,p=c},function(a){n=a}),j.call(c,0,function(){k&&k.apply(c,d),l.call(c,m,{needRepeat:o!==!1?o||0:o,timeoutAmount:p,finallyFn:n,controlNexus:{resolve:g(f,h.updateSettledTrue),reject:g(i,h.updateSettledFalse),notify:e(b.trigger,J.progress),status:h.status}})})):g(i,h.updateSettledFalse)("empty.description")})}finally{f.abort=e(h.updateSettledVal,"aborted"),f.pause=e(h.updateSettledVal,"paused"),f.resume=e(h.updateSettledVal,null),f.then(e(b.trigger,J.done),e(b.trigger,J.fail)),f.then(function(){c.isIdle()&&b.trigger(J.idle)},function(){c.isIdle()&&b.trigger(J.idle)})}}function l(a,b){var c=b.needRepeat,d=b.timeoutAmount,e=b.finallyFn,f=b.controlNexus,g=f.resolve,h=f.reject,i=f.notify,k=G.isNumber(c)?c:0,m=0===c?!0:c;j.call(this,d||0,function(){var c,d,j,n,o=0,p=0,q=null===f.status()&&!this.isPaused&&!this.isAborted;if(q){c=new Date;do{try{d=new Date,a(g,h,i,{batchStarted:c,batchIndex:o,batchElapsed:p})}catch(r){h(r)}p+=new Date-d,o++,j=!!m&&k>p&&null===f.status()}while(j)}else(this.isAborted||"aborted"===f.status())&&h("aborted");var s=f.status();if(n=!(!m||null!==s&&"paused"!==s||this.isAborted))return l.call(this,a,b);try{e&&e.call(this,s)}catch(r){}})}function m(){return this.isAborted=!0,this}function n(){return this.isPaused=!0,this}function o(){return delete this.isPaused,this}function p(a){var b,c=E.call(arguments,1);try{return b=new r(a)}finally{b.done(function(){for(var a,b=E.call(arguments,0);a=c.shift();)a instanceof r&&a.run.apply(a,b)})}}function q(a,b){var c=b||{};return{on:f(a,h,c),trigger:f(a,i,c)}}function r(a){if(!(this instanceof r))return new r(a);if(!G.isFunction(a))return b("CrunchTask.ctor","Single argument is required: `fn(initFn,bodyFn,finFn)`");var c=q(this);return s(this,c,a)}function s(a,b,g){return d(a,{id:c(),timestamp:new Date-0,runCount:0,isIdle:function(){return 0===a.runCount},pause:f(a,n),resume:f(a,o),abort:f(a,m),run:e(a,k,g,b),then:e(a,p,g),onRun:e(b.on,J.run),onIdle:e(b.on,J.idle),done:e(b.on,J.done),fail:e(b.on,J.fail),always:e(b.on,[J.done,J.fail].join()),progress:e(b.on,J.progress)})}function t(){for(var b=arguments.length,c=0;a(arguments[b-1-c]);)c++;var d=E.call(arguments,0,b-c),e=E.call(arguments,-c),f=B(A(d)),g=e[0],h=e[1]||function(){};return g?v(f,g,h):w()}function u(){var a=E.call(arguments,0);return B(A(a))}function v(a,b,c){return new r(function(d,e,f){var g,h=a;d(function(){var a=E.call(arguments,0);a.length&&(h=B(A(a))),g=z(h,!0)}),e(function(a){g&&x(b,y(h)),g&&z(h)||a()},100),f(function(){x(c,y(h))})})}function w(){return new r(function(a,b){b(function(a){a()})})}function x(a,b){G.isFunction(a)?a.apply(this,b):a instanceof r&&a.run.apply(a,b)}function y(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c].current);return b}function z(a,b){var c,d,e,f=0,g=a.length;do d=!1,c=a[f],b!==!0&&(c.current+=c.step),(!c.inclusive&&c.current===c.to||(c.step>0?c.current>c.to:c.current<c.to))&&(c.current=c.from,d=!0,f++),e=g>f;while(d&&e);return!d&&e}function A(a,b){for(var c,d,e=[],f=[];a.length;)c=a.splice(0,1)[0],d=G.isArray(c),d&&b!==!0?(f.length&&(e.push(f),f=[]),e.push(A(c,!0))):G.isBoolean(c)?(f.push(c),e.push(f),f=[]):G.isNumber(c)&&f.push(c);return f.length&&e.push(f),b===!0?e[0]:e}function B(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(C(a[c]));return b}function C(a){var c,d=a.length,e=d-1,f=G.isBoolean(a[e]);switch(d-(f?1:0)){case 2:case 3:return c=d-(f?1:0)===3?a[2]:a[0]<=a[1]?1:-1,{from:a[0],current:a[0],to:a[1],step:c,inclusive:f?a[d-1]:!1};case 0:case 1:b("Ranges","Use at least two values to define a range.");break;default:d%2===0&&d%3===0?b("Ranges","Use arrays to split range parts. Cannot determine pattern now."):b("Ranges","Use arrays to split range parts properly.")}}var D="object"==typeof window&&window?window:global,E=[].slice,F={}.hasOwnProperty,G=function(){function a(a){return function(b){return e.call(b)===a}}for(var b,c,d={},e=Object.prototype.toString,f=[!0,1,[],function(){},b],g=/\s+(\w+)]/,h=0,i=f.length;i>h;h++)c=e.call(f[h]).replace("DOMWindow","Undefined"),d["is"+c.match(g)[1]]=a(c);return d}(),H="undefined"!=typeof H?H:"undefined"!=typeof D.Promise?D.Promise:"undefined"!=typeof require?require("promise-polyfill"):!1;H===!1&&b("Linking",'Dependency isn\'t met: "promise-polyfill"'),G.isFunction(H.prototype.done)||(H.prototype.done=function(){var a=arguments.length?this.then.apply(this,arguments):this;return a.then(null,function(a){setTimeout(function(){throw a},0)})}),"undefined"!=typeof module&&module.exports?module.exports=D.CrunchTask?D.CrunchTask:r:D.CrunchTask||(D.CrunchTask=r),r["for"]=t,r.range=t,r.rangeCheck=u,r.rangeNextAndCheck=z;var I=0,J={run:"event.run",done:"event.done",fail:"event.fail",progress:"event.progress",idle:"event.idle"}}();