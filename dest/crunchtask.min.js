/*! crunchtask - v0.3.0 - 2015-02-14 */!function(){function a(a,b){return function(){a.apply(b,arguments)}}function b(b){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof b)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],h(b,a(d,this),a(e,this))}function c(a){var b=this;return null===this._state?void this._deferreds.push(a):void j(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function d(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"==typeof b||"function"==typeof b)){var c=b.then;if("function"==typeof c)return void h(a(c,b),a(d,this),a(e,this))}this._state=!0,this._value=b,f.call(this)}catch(g){e.call(this,g)}}function e(a){this._state=!1,this._value=a,f.call(this)}function f(){for(var a=0,b=this._deferreds.length;b>a;a++)c.call(this,this._deferreds[a]);this._deferreds=null}function g(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function h(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var i;i="object"==typeof window&&window?window:global,"undefined"!=typeof module&&module.exports?module.exports=i.Promise?i.Promise:b:i.Promise||(i.Promise=b);var j=i.setImmediate||function(a){setTimeout(a,1)},k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.prototype["catch"]=function(a){return this.then(null,a)},b.prototype.then=function(a,d){var e=this;return new b(function(b,f){c.call(e,new g(a,d,b,f))})},b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new b(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},b.resolve=function(a){return a&&"object"==typeof a&&a.constructor===b?a:new b(function(b){b(a)})},b.reject=function(a){return new b(function(b,c){c(a)})},b.race=function(a){return new b(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})}}(),function(){function a(a){return F.isFunction(a)||a instanceof r}function b(a,b){throw F.isUndefined(b)&&(b=a,a="Generic"),new Error(["`CT_",a,"`. Message: ",b].join(""))}function c(){return++H}function d(a,b){for(var c in b)E.call(b,c)&&(a[c]=b[c]);return a}function e(){var a=this,b=arguments[0],c=D.call(arguments,1);return!F.isFunction(b)&&F.isFunction(c[0])&&(a=arguments[0],b=c.shift()),function(){var d=D.call(arguments,0);return b.apply(a,[].concat(c,d))}}function f(a,b){var c=D.call(arguments,2);return function(){var d=D.call(arguments,0);return b.apply(a,[].concat(c,d))||a}}function g(a){var b=D.call(arguments,1);return function(){for(var c,d=D.call(arguments,0);(c=b.shift())&&F.isFunction(c);)c.apply(this,d);return a.call(this,d)}}function h(a,b,c){if(c)for(var d,e,f=D.call(arguments,3),g=b.split(/\s*,\s*/);d=g.shift();)(e=a[d])?e.push([c,f]):a[d]=[[c,f]]}function i(a,b){var c=D.call(arguments,2);if(1===c.length&&F.isArray(c[0])&&(c=c[0]),a[b])for(var d,e,f,g=a[b],h=0,i=g.length;i>h;h++)if(d=g[h],e=d[0],f=d[1],e)try{e.apply(this,[].concat(f,c))}catch(j){console.info(j)}}function j(a,b,c){var d=this;setTimeout(function(){b.apply(d,c)},a||0)}function k(a,b){var c=this,d=D.call(arguments,2);delete this.isPaused,delete this.isAborted,this.runCount++,b.trigger(I.run);var f,h=function(a){var b={isSettled:null},c={"null":!1,"true":!0,"false":!0,paused:!1,aborted:!0};return{updateSettledTrue:function(){c[b.isSettled]||(b.isSettled=!0,a.runCount--)},updateSettledFalse:function(){c[b.isSettled]||(b.isSettled=!1,a.runCount--)},updateSettledVal:function(d){c[b.isSettled]||(b.isSettled=d,c[d]&&a.runCount--)},status:function(){return b.isSettled}}}(c);try{return f=new G(function(f,i){var k,m,n,o,p;a?(a(function(a){k=a},function(a,b,c){m=a,o=b,p=c},function(a){n=a}),j.call(c,0,function(){k&&k.apply(c,d),l.call(c,m,o!==!1?o||0:o,p,n,{resolve:g(f,h.updateSettledTrue),reject:g(i,h.updateSettledFalse),notify:e(b.trigger,I.progress),status:h.status})})):g(i,h.updateSettledFalse)("empty.description")})}finally{f.abort=e(h.updateSettledVal,"aborted"),f.pause=e(h.updateSettledVal,"paused"),f.resume=e(h.updateSettledVal,null),f.then(e(b.trigger,I.done),e(b.trigger,I.fail)),f.then(function(){c.isIdle()&&b.trigger(I.idle)},function(){c.isIdle()&&b.trigger(I.idle)})}}function l(a,b,c,d,e){var f=e.resolve,g=e.reject,h=e.notify,i=F.isNumber(b)?b:0,k=0===b?!0:b;j.call(this,c||0,function(){var j,m,n,o,p=0,q=0,r=null===e.status()&&!this.isPaused&&!this.isAborted;if(r){j=new Date;do{try{m=new Date,a(f,g,h,{batchStarted:j,batchIndex:p,batchElapsed:q})}catch(s){g(s)}q+=new Date-m,p++,n=!!k&&i>q&&null===e.status()}while(n)}else(this.isAborted||"aborted"===e.status())&&g("aborted");var t=e.status();if(o=!(!k||null!==t&&"paused"!==t||this.isAborted))return l.call(this,a,b,c,d,e);try{d&&d.call(this,t)}catch(s){}})}function m(){return this.isAborted=!0,this}function n(){return this.isPaused=!0,this}function o(){return delete this.isPaused,this}function p(a){var b,c=D.call(arguments,1);try{return b=new r(a)}finally{b.done(function(){for(var a,b=D.call(arguments,0);a=c.shift();)a instanceof r&&a.run.apply(a,b)})}}function q(a,b){return{on:f(a,h,b),trigger:f(a,i,b)}}function r(a){if(!(this instanceof r))return new r(a);F.isFunction(a)||b("CrunchTask.ctor","Single argument is required: `fn(initFn,bodyFn,finFn)`"),this.id=c(),this.timestamp=new Date-0,this.runCount=0,this.isIdle=function(){return 0===this.runCount};var g=q(this,{});d(this,{pause:f(this,n),resume:f(this,o),abort:f(this,m),run:e(this,k,a,g),then:e(this,p,a),onRun:e(g.on,I.run),onIdle:e(g.on,I.idle),done:e(g.on,I.done),fail:e(g.on,I.fail),always:e(g.on,[I.done,I.fail].join()),progress:e(g.on,I.progress)})}function s(){for(var b=arguments.length,c=0;a(arguments[b-1-c]);)c++;var d=D.call(arguments,0,b-c),e=D.call(arguments,-c),f=A(z(d)),g=e[0],h=e[1]||function(){};return g?u(f,g,h):v()}function t(){var a=D.call(arguments,0);return A(z(a))}function u(a,b,c){return new r(function(d,e,f){var g,h=a;d(function(){var a=D.call(arguments,0);a.length&&(h=A(z(a))),g=y(h,!0)}),e(function(a){g&&w(b,x(h)),g&&y(h)||a()},100),f(function(){w(c,x(h))})})}function v(){return new r(function(a,b){b(function(a){a()})})}function w(a,b){F.isFunction(a)?a.apply(this,b):a instanceof r&&a.run.apply(a,b)}function x(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c].current);return b}function y(a,b){var c,d,e,f=0,g=a.length;do d=!1,c=a[f],b!==!0&&(c.current+=c.step),c.inclusive?(c.step>0?c.current>c.to:c.current<c.to)&&(c.current=c.from,d=!0,f++):(c.step>0?c.current>=c.to:c.current<=c.to)&&(c.current=c.from,d=!0,f++),e=g>f;while(d&&e);return!d&&e}function z(a,b){for(var c,d,e=[],f=[];a.length;)c=a.splice(0,1)[0],d=F.isArray(c),d&&b!==!0?(f.length&&(e.push(f),f=[]),e.push(z(c,!0))):F.isBoolean(c)?(f.push(c),e.push(f),f=[]):F.isNumber(c)&&f.push(c);return f.length&&e.push(f),b===!0?e[0]:e}function A(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(B(a[c]));return b}function B(a){var c,d=a.length,e=d-1,f=F.isBoolean(a[e]);switch(d-(f?1:0)){case 2:case 3:return c=d-(f?1:0)===3?a[2]:a[0]<=a[1]?1:-1,{from:a[0],current:a[0],to:a[1],step:c,inclusive:f?a[d-1]:!1};case 0:case 1:b("Ranges","Use at least two values to define a range.");default:d%2===0&&d%3===0?b("Ranges","Use arrays to split range parts. Cannot determine pattern now."):b("Ranges","Use arrays to split range parts properly.")}}var C="object"==typeof window&&window?window:global,D=[].slice,E={}.hasOwnProperty,F=function(){for(var a,b,c={},d=Object.prototype.toString,e=[!0,1,[],function(){},a],f=/\s+(\w+)]/,g=0,h=e.length;h>g;g++)b=d.call(e[g]),c["is"+b.match(f)[1]]=function(a){return function(b){return d.call(b)===a}}(b);return c}(),G="undefined"!=typeof G?G:"undefined"!=typeof C.Promise?C.Promise:"undefined"!=typeof require?require("promise-polyfill"):!1;G===!1&&b("Linking",'Dependency isn\'t met: "promise-polyfill"'),"undefined"!=typeof module&&module.exports?module.exports=C.CrunchTask?C.CrunchTask:r:C.CrunchTask||(C.CrunchTask=r),r["for"]=s,r.range=s,r.rangeCheck=t,r.rangeNextAndCheck=y;var H=0,I={run:"event.run",done:"event.done",fail:"event.fail",progress:"event.progress",idle:"event.idle"}}();