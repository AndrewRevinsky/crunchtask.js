!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(a,b){for(var c={},e=d.isArray(b),f=0,g=a.length;g>f;f++)c[a[f]]=e?b[f]:b;return c}var d=a("./type");b.exports=c},{"./type":14}],2:[function(a,b){"use strict";function c(a,b){var c=d.call(arguments,2);return function(){var e=d.call(arguments,0);return b.apply(a,[].concat(c,e))||a}}var d=[].slice;b.exports=c},{}],3:[function(a,b){"use strict";var c={trace:!1,timeLimit:100,timeoutAmount:0,debug:!1},d={trace:!1,timeLimit:100,timeoutAmount:0,debug:!1};b.exports={config:c,defaultConfig:d}},{}],4:[function(a,b){(function(c){/**
 * @preserve
 * @module CrunchTask
 * Created by AndrewRevinsky on 10/10/2014.
 */
!function(){"use strict";function d(){return++R}function e(a,b){var c=this,e=M.staticParentTask;M.staticParentTask=null;var i={},j={task:c,id:"T_"+c.id+":"+d(),conditionsToMeet:1,state:T.init,runBlock:0,runArgs:y.call(arguments,2),descriptionFn:a,parentTask:e},k=null,l=function(a,c){k=E(j,g,i,b,{resolve:a,reject:c}),K.call(j,0,h,[i])};return f(new O(l),i,k)}function f(a,b,c){return c(a),D(a,{onError:E(a,b.runEventsOn,S.error),abort:E(a,b.abort),pause:E(a,b.pause),resume:E(a,b.resume),done:E(a,b.runEventsOn,S.done),fail:E(a,b.runEventsOn,S.fail),always:E(a,b.runEventsOn,[S.done,S.fail,S.error].join()),progress:E(a,b.runEventsOn,S.progress)})}function g(a,b,c,d){function e(){if(!U[i.state]){var a=y.call(arguments,0);i.state=T.error,i.value=a,f(a,S.error,m)}}function f(a,b,c){o.apply(this,[b].concat(a)),c&&K.call(j,0,c,[a])}function g(a,b){K(1,function(){a.runCount+b.runCount>0||(M.staticSecurityLock=!0,a._signalIdle(),M.staticSecurityLock=!0,b._signalIdle(),delete i.parentTask,delete b.childTask)})}function h(a){a.runCount=Math.max(0,a.runCount-1),a.runCount||(delete a.isAborted,delete a.isPaused,a.childTask?g(a.childTask,a):i.parentTask?g(a,i.parentTask):K(1,function(){a.runCount||(M.staticSecurityLock=!0,a._signalIdle())}))}var i=this,j=i.task,k=i.parentTask,l=L(c.resolve),m=L(c.reject),n=G(d),o=J(n.trigger,b.trigger);return k&&(k.childTask=j),D(a,{setupInit:function(a){return P.trace&&console.log("setupInit",new Date-0),U[i.state]?void 0:A.isUndefined(a)||A.isFunction(a)?void(i.initFn=L(j,a)):e("CrunchTask.description.initSetup","Init setup expects an optional function.")},setupBody:function(a,b,c){if(P.trace&&console.log("setupBody",new Date-0),!U[i.state]){if(!A.isFunction(a))return e("CrunchTask.description.bodySetup","Body setup expects a function as a first optional arg.");if(!A.isUndefined(b)&&!A.isBoolean(b)&&!A.isNumber(b))return e("CrunchTask.description.bodySetup","Body setup expects a number or false as a 2nd optional arg.");if(!A.isUndefined(c)&&!A.isNumber(c))return e("CrunchTask.description.bodySetup","Body setup expects a number as a 3rd optional arg.");i.bodyFn=L(j,a),i.conditionsToMeet--,i.needRepeat=b,i.timeoutAmount=c}},setupFin:function(a){return P.trace&&console.log("setupFin",new Date-0),U[i.state]?void 0:A.isUndefined(a)||A.isFunction(a)?void(i.finallyFn=L(j,a)):e("CrunchTask.description.finSetup","Fin setup expects a function as a first optional arg.")},signalError:e,runEventsOn:n.on,goRunning:function(){j.runCount++,i.state=T.running,b.trigger(S.run,i.id)},resolve:function(){if(!U[i.state]){var a=y.call(arguments,0);i.state=T.resolved,i.value=a,h(j),f(a,S.done,l)}},reject:function(){if(!U[i.state]){var a=y.call(arguments,0);i.state=T.rejected,i.value=a,h(j),f(a,S.fail,m)}},abort:function(){return U[i.state]?void 0:(i.state=T.aborted,this)},pause:function(){return U[i.state]?void 0:(i.state=T.paused,this)},resume:function(){return U[i.state]?void 0:(i.state=T.running,this)},sendNotify:E(o,S.progress)})}function h(a){var b=this,c=b.task,d=b.descriptionFn;if(!d)return a.signalError("CrunchTask.description.empty","Description function is empty.");if(P.trace&&console.log("before descriptionFn run",new Date-0),!L(c,d)(a.setupInit,a.setupBody,a.setupFin)||U[b.state]||0!==b.conditionsToMeet)return a.signalError("CrunchTask.description.else","");P.trace&&console.log("after descriptionFn run",new Date-0);var e=b.needRepeat;e=e===!1?e:0===e?e:e||P.timeLimit,b.needRepeat=0===e?!0:e,b.timeoutAmount=b.timeoutAmount||P.timeoutAmount,P.trace&&(console.log("collected `needRepeat`:",b.needRepeat),console.log("collected `timeoutAmount`:",b.timeoutAmount)),a.goRunning(),P.trace&&console.log("before defer",new Date-0),K.call(b,0,function(){P.trace&&console.log("inside defer",new Date-0),this.initFn&&!this.initFn.apply(this,this.runArgs)&&a.signalError("CrunchTask.description.init"),P.trace&&console.log("before  proceedBodyFn",new Date-0),i.call(this,a,!0)})}function i(a,b){P.trace&&(console.log("inside proceedBodyFn",this.id,new Date-0),console.log("isFirstTime",b),console.log("this.timeoutAmount",this.timeoutAmount)),K.call(this,b?0:this.timeoutAmount,function(a){P.trace&&console.log("inside proceedBodyFn:defer",this.id,new Date-0);var b,c,d,e,f=this.task,g=this.needRepeat,h=A.isNumber(g)?g:0,j=0,k=0,l=this.state===T.running&&!f.isPaused&&!f.isAborted;if(l){b=new Date;do{try{c=new Date,this.bodyFn(a.resolve,a.reject,a.sendNotify,{batchStarted:b,batchIndex:j,batchElapsed:k,runBlock:this.runBlock})}catch(m){P.debug&&console.log(m+", stack: "+m.stack),a.signalError("body",m)}k+=new Date-c,j++,d=g&&0!==h&&h>k&&this.state===T.running}while(d)}else(f.isAborted||this.state===T.aborted)&&a.reject("aborted");return(e=g&&V[this.state]&&!f.isAborted)?(this.runBlock++,P.trace&&console.log("rescheduling proceedBodyFn",this.id,new Date-0),i.call(this,a)):(g===!1&&a.resolve(),void(this.finallyFn&&!this.finallyFn.call(this,W[this.state])&&a.signalError("CrunchTask.description.fin",this.status)))},[a])}function j(){return this.isAborted=!0,this}function k(){return this.isPaused=!0,this}function l(){return delete this.isPaused,this}function m(a){function b(){for(var a,b=y.call(arguments,0);a=d.shift();)w(a)(b)}var c,d=y.call(arguments,1);try{return c=new n(a)}finally{c.done(b),this.done(b)}}function n(a){return this instanceof n?o(this,G(this),a):new n(a)}function o(a,b,c){return D(a,{id:d(),timestamp:new Date-0,runCount:0,isIdle:function(){return 0===a.runCount},pause:F(a,k),resume:F(a,l),abort:F(a,j),run:E(a,e,c,b),then:E(a,m),onRun:E(b.on,S.run),onIdle:E(b.on,S.idle),onError:E(b.on,S.error),done:E(b.on,S.done),fail:E(b.on,S.fail),always:E(b.on,[S.done,S.fail,S.error].join()),progress:E(b.on,S.progress),_signalIdle:function(){M.staticSecurityLock&&(M.staticSecurityLock=!1,b.trigger(S.idle))}})}function p(a){return A.isFunction(a)||a instanceof n}function q(){for(var a=arguments.length,b=0;p(arguments[a-1-b]);)b++;var c=y.call(arguments,0,a-b),d=y.call(arguments,-b),e=new N(c),f=d[0],g=d[1]||function(){};return f?u(e,f,g):v()}function r(a,b,c){return new n(function(d,e,f){var g,h,i,j=a,k=w(b,this),l=w(c,this);d(function(b){b&&(j=a),g=new N([0,j.length]),i=g.canAdvance(!0)}),e(function(a){i&&(h=g.valueOf()[0],k([j[h],h])),i&&g.canAdvance()||a()},P.timeLimit,P.timeoutAmount),f(function(){l(g.valueOf())})})}function s(a,b,c,d){return new n(function(e,f,g){var h,i,j,k=a,l=b,m=w(c,this),n=w(d,this);e(function(b,c){b&&(k=a),h=new N([0,k.length]),j=h.canAdvance(!0),A.isUndefined(c)||(l=c)}),f(function(a){j&&(i=h.valueOf()[0],l=m([l,k[i],i])),j&&h.canAdvance()||a(l)},P.timeLimit,P.timeoutAmount),g(function(){n(l,h.valueOf())})})}function t(){var a=y.call(arguments,0);return new N(a)}function u(a,b,c){return new n(function(d,e,f){var g,h=a,i=w(b,this),j=w(c,this);d(function(){var a=y.call(arguments,0);a.length&&(h=new N(a)),g=h.canAdvance(!0)}),e(function(a){g&&i(h.valueOf()),g&&h.canAdvance()||a()},P.timeLimit,P.timeoutAmount),f(function(){j(h.valueOf())})})}function v(){return new n(function(a,b){b(function(a){a()})})}function w(a,b){return A.isFunction(a)?function(c){return a.apply(b||this,c)}:a instanceof n?function(c){return M.staticParentTask=b,a.run.apply(a,c)}:function(a){return a}}var x="object"==typeof window&&window?window:"undefined"!=typeof c&&"undefined"!=typeof b&&b.exports?b.exports:{},y=[].slice,z={}.hasOwnProperty,A=a("./type"),B=a("./mirror"),C=a("./arrayToObject"),D=a("./extend"),E=a("./partial"),F=a("./bind"),G=a("./events"),H=a("./config"),I=a("./error"),J=a("./together"),K=a("./defer"),L=a("./safe"),M=a("./globals"),N=a("./typeRange"),O=a("promise-polyfill");O===!1&&I("Linking",'Dependency isn\'t met: "promise-polyfill"');var P=H.config,Q=H.defaultConfig;x.CrunchTask=n,D(n,{"for":q,range:q,rangeCheck:t,rangeNextAndCheck:function(a,b){return a.canAdvance(b)},forEach:r,reduce:s,config:function X(a){if(!A.isObject(a))return X(Q);var b={};for(var c in a)z.call(a,c)&&z.call(P,c)&&(P[c]=a[c],b[c]=a[c]);return b}}),n.config(!1);var R=0,S=B({run:null,done:null,fail:null,abort:null,error:null,progress:null,idle:null},"event."),T=B({init:null,error:null,running:null,paused:null,resolved:null,rejected:null,aborted:null},"state."),U=C([T.error,T.resolved,T.rejected,T.aborted],!0),V=C([T.running,T.paused],!0),W=C([T.resolved,T.rejected,T.error,T.aborted],["success","failure","error","aborted"])}()}).call(this,a("_process"))},{"./arrayToObject":1,"./bind":2,"./config":3,"./defer":5,"./error":6,"./events":7,"./extend":8,"./globals":9,"./mirror":10,"./partial":11,"./safe":12,"./together":13,"./type":14,"./typeRange":15,_process:16,"promise-polyfill":17}],5:[function(a,b){"use strict";function c(a,b,c){var d=this;return setTimeout(function(){b.apply(d,c||[])},a||0)}b.exports=c},{}],6:[function(a,b){"use strict";function c(a,b){throw d.isUndefined(b)&&(b=a,a="Generic"),new Error(["`CT_",a,"`. Message: ",b].join(""))}var d=a("./type");b.exports=c},{"./type":14}],7:[function(a,b){"use strict";function c(a,b,c){if(c)for(var d,e,g=f.call(arguments,3),h=b.split(/\s*,\s*/);d=h.shift();)(e=a[d])?e.push([c,g]):a[d]=[[c,g]]}function d(a,b){var c=f.call(arguments,2);if(a[b])for(var d,e,g=a[b],h=0,j=g.length;j>h;h++)if(d=g[h][0],e=g[h][1],d)try{d.apply(this,[].concat(e,c))}catch(k){i.debug&&console.log(k+", stack: "+k.stack)}}function e(a,b){var e=b||{};return{on:g(a,c,e),trigger:g(a,d,e)}}var f=[].slice,g=a("./bind"),h=a("./config"),i=h.config;b.exports=e},{"./bind":2,"./config":3}],8:[function(a,b){"use strict";function c(a,b){for(var c in b)d.call(b,c)&&(a[c]=b[c]);return a}var d={}.hasOwnProperty;b.exports=c},{}],9:[function(a,b){b.exports={staticLastSafeError:null,staticParentTask:null,staticSecurityLock:null}},{}],10:[function(a,b){"use strict";function c(a,b){for(var c in a)d.call(a,c)&&(a[c]=b+c);return a}var d={}.hasOwnProperty;b.exports=c},{}],11:[function(a,b){"use strict";function c(){var a=this,b=arguments[0],c=d.call(arguments,1);return!e.isFunction(b)&&e.isFunction(c[0])&&(a=arguments[0],b=c.shift()),function(){var e=d.call(arguments,0);return b.apply(a,[].concat(c,e))}}var d=[].slice,e=a("./type");b.exports=c},{"./type":14}],12:[function(a,b){"use strict";function c(a,b){return e.isFunction(a)&&(b=a,a=this),e.isFunction(b)||(b=function(){}),function(){var c=d.call(arguments,0);try{return b.apply(a,c),!0}catch(e){return g.staticLastSafeError=e,h.debug&&console.log(e+", stack: "+e.stack),!1}}}var d=[].slice,e=a("./type"),f=a("./config"),g=a("./globals"),h=f.config;b.exports=c},{"./config":3,"./globals":9,"./type":14}],13:[function(a,b){"use strict";function c(){var a=d.call(arguments,0);return function(){for(var b,c=d.call(arguments,0),f=[].concat(a);(b=f.shift())&&e.isFunction(b);)b.apply(this,c)}}var d=[].slice,e=a("./type");b.exports=c},{"./type":14}],14:[function(a,b){"use strict";function c(a){return function(b){return h.call(b)===a}}for(var d,e,f,g={},h=Object.prototype.toString,i=[!0,1,[],function(){},d,{}],j=/\s+(\w+)]/,k=0,l=i.length;l>k;k++)e=(f=h.call(i[k])).replace("DOMWindow","Undefined"),g["is"+e.match(j)[1]]=c(f);b.exports=g},{}],15:[function(a,b){"use strict";function c(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b(a[d],d));return c}function d(a){return(arguments.length>1||!h.isArray(a))&&i("Ranges","Pass strictly a single arguments of type array"),this instanceof d?void(this.data=e(g(a))):new d(a)}function e(a){return c(a,f)}function f(a){var b,c=a.length,d=c-1,e=h.isBoolean(a[d]);switch(c-(e?1:0)){case 2:case 3:return b=c-(e?1:0)===3?a[2]:a[0]<=a[1]?1:-1,{from:a[0],current:a[0],to:a[1],step:b,inclusive:e?a[c-1]:!1};case 0:case 1:i("Ranges","Use at least two values to define a range.");break;default:c%2===0&&c%3===0?i("Ranges","Use arrays to split range parts. Cannot determine pattern now."):i("Ranges","Use arrays to split range parts properly.")}}function g(a,b){for(var c,d,e=[],f=[];a.length;)c=a.splice(0,1)[0],d=h.isArray(c),d&&b!==!0?(f.length&&(e.push(f),f=[]),e.push(g(c,!0))):h.isBoolean(c)?(f.push(c),e.push(f),f=[]):h.isNumber(c)&&f.push(c);return f.length&&e.push(f),b===!0?e[0]:e}var h=a("./type"),i=a("./error");d.prototype.toString=d.prototype.valueOf=function(){return c(this.data,function(a){return a.current})},d.prototype.canAdvance=function(a){var b,c,d,e=0,f=this.data,g=f.length;do c=!1,b=f[e],a!==!0&&(b.current+=b.step),(!b.inclusive&&b.current===b.to||(b.step>0?b.current>b.to:b.current<b.to))&&(b.current=b.from,c=!0,e++),d=g>e;while(c&&d);return!c&&d},b.exports=d},{"./error":6,"./type":14}],16:[function(a,b){function c(){j=!1,g.length?i=g.concat(i):k=-1,i.length&&d()}function d(){if(!j){var a=setTimeout(c);j=!0;for(var b=i.length;b;){for(g=i,i=[];++k<b;)g[k].run();k=-1,b=i.length}g=null,j=!1,clearTimeout(a)}}function e(a,b){this.fun=a,this.array=b}function f(){}var g,h=b.exports={},i=[],j=!1,k=-1;h.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];i.push(new e(a,b)),1!==i.length||j||setTimeout(d,0)},e.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=f,h.addListener=f,h.once=f,h.off=f,h.removeListener=f,h.removeAllListeners=f,h.emit=f,h.binding=function(){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],17:[function(a,b){(function(a){!function(){function c(a,b){return function(){a.apply(b,arguments)}}function d(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],j(a,c(f,this),c(g,this))}function e(a){var b=this;return null===this._state?void this._deferreds.push(a):void l(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function f(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var b=a.then;if("function"==typeof b)return void j(c(b,a),c(f,this),c(g,this))}this._state=!0,this._value=a,h.call(this)}catch(d){g.call(this,d)}}function g(a){this._state=!1,this._value=a,h.call(this)}function h(){for(var a=0,b=this._deferreds.length;b>a;a++)e.call(this,this._deferreds[a]);this._deferreds=null}function i(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function j(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var k;k="object"==typeof window&&window?window:a,"undefined"!=typeof b&&b.exports?b.exports=k.Promise?k.Promise:d:k.Promise||(k.Promise=d);var l=k.setImmediate||function(a){setTimeout(a,1)},m=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};d.prototype["catch"]=function(a){return this.then(null,a)},d.prototype.then=function(a,b){var c=this;return new d(function(d,f){e.call(c,new i(a,b,d,f))})},d.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&m(arguments[0])?arguments[0]:arguments);return new d(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},d.resolve=function(a){return a&&"object"==typeof a&&a.constructor===d?a:new d(function(b){b(a)})},d.reject=function(a){return new d(function(b,c){c(a)})},d.race=function(a){return new d(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})}}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]);
//# sourceMappingURL=crunchtask.min.js.map